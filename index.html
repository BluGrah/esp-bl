async function transferToFlash() {
        const id = document.getElementById('stationSelect').value;
        log("Fetching files from Drive...");
        const resp = await fetch(document.getElementById('scriptUrl').value + `?action=getCerts&id=${id}`);
        const certs = await resp.json();
        
        // Use your exact filenames as keys
        const queue = [
            {data: certs["root_ca.pem"], file: "root_ca.pem", domId: "caStat", label: "CA"},
            {data: certs["client_cert.pem"], file: "client_cert.pem", domId: "certStat", label: "Cert"},
            {data: certs["client_key.pem"], file: "client_key.pem", domId: "keyStat", label: "Key"}
        ];

        for (const item of queue) {
            if(!item.data) { 
                log(`Error: ${item.file} missing from Drive data`); 
                continue; 
            }
            
            const raw = atob(item.data.data);
            log(`Starting: ${item.file} (${raw.length} bytes)`);
            
            // Send START with exact filename
            await bleChar.writeValue(new TextEncoder().encode("S" + item.file));
            await waitAck("ACK_S");

            const size = 150;
            let cCount = 0;
            for (let i = 0; i < raw.length; i += size) {
                const chunk = raw.slice(i, i + size);
                await bleChar.writeValue(new TextEncoder().encode("D" + chunk));
                await waitAck("ACK_D");
                cCount++;
                if (cCount % 5 === 0) log(`${item.label}: Chunk ${cCount} OK...`);
            }

            // Send END
            await bleChar.writeValue(new TextEncoder().encode("E"));
            await waitAck("FS_READY");

            document.getElementById(item.domId).className = "status success";
            document.getElementById(item.domId).innerText = `${item.label}: In Flash ✅`;
            log(`${item.file} saved.`);
        }
        log("Step 1 Complete. Ready for Step 2.");
        document.getElementById('btnModem').disabled = false;
    }

    async function writeToModem() {
        const sequence = [
            {file: "root_ca.pem", domId: "caStat", label: "CA"},
            {file: "client_cert.pem", domId: "certStat", label: "Cert"},
            {file: "client_key.pem", domId: "keyStat", label: "Key"}
        ];
        
        for (const item of sequence) {
            log(`Step 2: Writing ${item.label} to Modem...`);
            await bleChar.writeValue(new TextEncoder().encode("W" + item.file));
            await waitAck("MODEM_OK");
            document.getElementById(item.domId).innerText = `${item.label}: Ready on Modem ✅`;
            log(`${item.label} Provisioned.`);
        }
        log("SUCCESS: All certificates on Modem.");
    }
